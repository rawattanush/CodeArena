<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practice | CodeArena</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@500;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        :root {
            --dark-bg: #0a0a0a;
            --primary-bg: #101010;
            --secondary-bg: #1a1a1a;
            --border-color: #2a2a2a;
            --accent-green: #00ff9c;
            --accent-blue: #00a2ff;
            --accent-yellow: #ffc83c;
            --accent-purple: #d96dff;
            --accent-cyan: #55ddec;
            --accent-red: #ff3c3c;
            --accent-glow: rgba(0, 255, 156, 0.2);
            --text-primary: #e0e0e0;
            --text-secondary: #888888;
            --font-body: 'Inter', sans-serif;
            --font-mono: 'Fira Code', monospace;
            --shadow: 0 0 20px rgba(0, 255, 156, 0.1);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow: hidden; /* Prevent body scroll */
        }

        body {
            font-family: var(--font-body);
            background-color: var(--dark-bg);
            color: var(--text-primary);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
        }

        .background-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -3; opacity: 0.2;
        }
        
        .container {
            width: 90%;
            max-width: 1400px;
            margin: 0 auto;
        }

        a { text-decoration: none; color: var(--accent-green); transition: var(--transition); }
        a:hover { filter: brightness(1.2); text-shadow: 0 0 5px var(--accent-glow);}
        h1, h2, h3, h4 { font-family: var(--font-mono); color: var(--text-primary); font-weight: 700; }
        
        /* --- HEADER & NAVIGATION --- */
        header {
            background-color: rgba(10, 10, 10, 0.8); backdrop-filter: blur(10px);
            position: relative; z-index: 1000;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        .header-content { display: flex; justify-content: space-between; align-items: center; height: 70px; }
        .logo { font-family: var(--font-mono); font-size: 1.5rem; color: var(--text-primary); display:flex; align-items:center; gap:10px;}
        .logo span { color: var(--accent-green); }
        .nav-right { display: flex; align-items: center; gap: 20px; }
        .nav-links { display: flex; align-items: center; list-style: none; gap: 20px; }
        .nav-links a { color: var(--text-secondary); font-weight: 500; font-family: var(--font-mono); font-size: 0.9rem; transition: var(--transition); position: relative; padding: 5px 0; }
        .nav-links a::after { content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 2px; background-color: var(--accent-green); transition: width 0.3s ease; }
        .nav-links a:hover, .nav-links a.active { color: var(--text-primary); text-shadow: 0 0 5px var(--accent-glow); }
        .nav-links a:hover::after, .nav-links a.active::after { width: 100%; }
        .notification-btn { background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--text-secondary); transition: var(--transition); position: relative; }
        .notification-btn:hover { color: var(--text-primary); }
        .badge {
            position: absolute; top: -5px; right: -5px; background-color: var(--accent-green); color: var(--dark-bg);
            border-radius: 50%; width: 18px; height: 18px; font-size: 0.7rem; display: flex;
            align-items: center; justify-content: center; font-weight: 700; font-family: var(--font-mono);
        }
        .avatar {
            width: 40px; height: 40px; border-radius: 4px; border: 2px solid var(--border-color);
            background-color: var(--secondary-bg); color: var(--text-primary); display: flex;
            align-items: center; justify-content: center; font-weight: 600; font-family: var(--font-mono); cursor: pointer; transition: var(--transition);
        }
        .avatar:hover { border-color: var(--accent-green); box-shadow: var(--shadow); }
        .binary-clock {
            font-family: var(--font-mono); font-size: 0.9rem; color: var(--accent-blue); padding: 5px 10px; border: 1px solid var(--border-color); border-radius: 4px; background: rgba(0, 0, 0, 0.3);
        }
        
        /* --- MAIN SCROLLABLE CONTENT AREA --- */
        .main-content {
            flex-grow: 1;
            overflow-y: auto;
            padding-top: 25px;
        }

        .section-title {
            margin: 25px 0; font-size: clamp(1.6rem, 4vw, 2rem); display: flex; align-items: center; gap: 15px; color: var(--text-primary);
        }
        .section-title i { color: var(--accent-green); transition: var(--transition); }
        .section-title:hover i { transform: rotate(15deg) scale(1.1); text-shadow: 0 0 10px var(--accent-glow); }

        /* --- GENERAL COMPONENTS --- */
        .card {
            background: radial-gradient(circle at 100% 5%, rgba(0, 255, 156, 0.05), transparent 40%),
                        radial-gradient(circle at 0% 95%, rgba(0, 162, 255, 0.05), transparent 40%), var(--primary-bg);
            border-radius: 12px; padding: 25px; border: 1px solid var(--border-color);
            transition: var(--transition); position: relative; overflow: hidden;
        }
        .card:hover { transform: translateY(-5px); border-color: rgba(224, 224, 224, 0.3); box-shadow: 0 8px 30px rgba(0,0,0,0.2); }
        .glitch-btn {
            padding: 10px 20px; border-radius: 4px; font-weight: 600; cursor: pointer; text-decoration: none; display: inline-flex;
            align-items:center; justify-content: center; gap: 8px; border: 1px solid var(--accent-green); font-size: 1rem; position: relative;
            overflow: hidden; background: transparent; color: var(--accent-green); font-family: var(--font-mono); transition: all 0.2s ease;
        }
        .glitch-btn:hover { color: var(--dark-bg); background-color: var(--accent-green); box-shadow: var(--shadow); }
        
        /* --- PRACTICE DASHBOARD --- */
        .practice-dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; }
        .dashboard-card { background-color: var(--secondary-bg); border-radius: 8px; padding: 25px; display: flex; flex-direction: column; }
        .dashboard-card__title { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; font-size: 1.1rem; color: var(--text-secondary); }
        .dashboard-card__title i { width: 20px; text-align: center; color: var(--accent-cyan); }
        .timer-panel { grid-column: 1 / -1; }
        @media (min-width: 1024px) { .timer-panel { grid-column: span 2; } }
        .timer-display-wrapper { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .timer-progress-container { position: relative; width: 220px; height: 220px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; }
        .progress-ring { position: absolute; width: 100%; height: 100%; }
        .progress-ring__circle { transition: stroke-dashoffset 0.5s; transform: rotate(-90deg); transform-origin: 50% 50%; }
        .timer-display { font-size: clamp(3rem, 10vw, 4rem); font-weight: 700; color: var(--text-primary); font-family: var(--font-mono); letter-spacing: -0.05em; }
        #timer-mode { font-size: 1rem; color: var(--accent-green); margin-bottom: 10px; font-family: var(--font-mono); }
        .timer-controls { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: auto; }
        .timer-settings { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 20px; margin-top: 20px; }
        .timer-settings.disabled, #practice-duration.disabled { opacity: 0.5; pointer-events: none; }
        .setting { display: flex; align-items: center; gap: 10px; color: var(--text-secondary); }
        .time-selector { display: flex; background-color: var(--primary-bg); border: 1px solid var(--border-color); border-radius: 6px; padding: 4px; }
        .time-selector-btn { background: transparent; border: none; color: var(--text-secondary); padding: 6px 14px; font-family: var(--font-mono); font-size: 0.9rem; cursor: pointer; border-radius: 4px; transition: var(--transition); }
        .time-selector-btn:hover { color: var(--text-primary); background-color: var(--border-color); }
        .time-selector-btn.active { background-color: var(--accent-green); color: var(--dark-bg); font-weight: 700; }
        
        .sound-selector {
            background-color: var(--primary-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
        }
        .sound-selector:focus {
            outline: none;
            border-color: var(--accent-green);
        }

        .goals-container { display: flex; flex-direction: column; gap: 15px; }
        .goal-display { display: flex; flex-direction: column; gap: 10px; }
        .goal-progress-bar-container { width: 100%; background: var(--border-color); border-radius: 99px; height: 10px; overflow: hidden; }
        #goal-progress-bar { background: var(--accent-green); height: 100%; border-radius: 99px; transition: width 0.5s ease; }
        #goal-questions-progress-bar { background: var(--accent-yellow); height: 100%; border-radius: 99px; transition: width 0.5s ease; }
        .goal-text-container { display: flex; justify-content: space-between; align-items: center; font-family: var(--font-mono); font-size: 0.9rem; }
        .edit-goal-btn { background: none; border: none; color: var(--text-secondary); cursor: pointer; transition: var(--transition); }
        .edit-goal-btn:hover { color: var(--text-primary); }
        .goal-input-container { display: none; }
        .goal-input-wrapper { display: flex; gap: 10px; margin-top: 10px; }
        .goal-input { flex-grow: 1; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--primary-bg); color: var(--text-primary); font-size: 1rem; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; text-align: center; flex-grow: 1; }
        .stat-item { background: var(--primary-bg); padding: 15px; border-radius: 6px; border: 1px solid var(--border-color); display: flex; flex-direction: column; justify-content: center;}
        .stat-value { font-size: 1.8rem; font-family: var(--font-mono); font-weight: 700; color: var(--accent-blue); }
        .stat-label { font-size: 0.8rem; color: var(--text-secondary); text-transform: uppercase; margin-top: 5px;}
        
        .stat-value.dual-stat { display: flex; align-items: baseline; justify-content: center; gap: 8px; }
        .dual-separator { color: var(--text-secondary); font-size: 1.2rem; font-weight: 400; }
        .stat-value.dual-stat > span:first-of-type { font-size: 1.8rem; font-weight: 700; }
        .stat-value.dual-stat > span:last-of-type { font-size: 1.2rem; color: var(--text-secondary); }
        .stat-label.dual-label { display: flex; justify-content: center; gap: 15px; position: relative; }
        .stat-label.dual-label::before { content: '/'; position: absolute; color: var(--text-secondary); }
        #stats-session-time { color: var(--accent-blue); }
        #stats-session-questions { color: var(--accent-yellow) !important; }

        .questions-control { display: flex; align-items: center; justify-content: center; gap: 10px; }
        .q-btn { background: var(--border-color); border: none; color: var(--text-primary); width: 28px; height: 28px; border-radius: 50%; font-size: 1rem; cursor: pointer; transition: var(--transition); }
        .q-btn:hover { background-color: var(--accent-green); color: var(--dark-bg); }
        
        /* --- AESTHETIC FILTER BAR --- */
        .filter-bar-container { padding: 15px 25px; display: flex; flex-wrap: wrap; gap: 20px; align-items: center; position: relative; }
        .filter-bar-container.card { overflow: visible; z-index: 2; }
        .search-container { flex-grow: 1; min-width: 250px; }
        .search-input { width: 100%; padding: 10px 15px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 1rem; background-color: var(--secondary-bg); color: var(--text-primary); transition: var(--transition); }
        .search-input:focus { border-color: var(--accent-green); box-shadow: 0 0 0 2px var(--accent-glow); outline: none; }
        .filter-controls { display: flex; flex-wrap: wrap; gap: 10px; }
        .filter-dropdown-wrapper { position: relative; }
        .filter-category-btn { background: var(--secondary-bg); border: 1px solid var(--border-color); color: var(--text-secondary); padding: 10px 15px; font-family: var(--font-mono); font-size: 0.9rem; cursor: pointer; border-radius: 4px; transition: var(--transition); display: flex; align-items: center; gap: 8px; }
        .filter-category-btn:hover { color: var(--text-primary); border-color: var(--accent-cyan); }
        .filter-category-btn.active { color: var(--accent-cyan); border-color: var(--accent-cyan); }
        .filter-count { background: var(--accent-cyan); color: var(--dark-bg); border-radius: 50%; width: 20px; height: 20px; font-size: 0.8rem; display: none; align-items: center; justify-content: center; margin-left: 8px; font-weight: 700; }
        .filter-category-btn.active .filter-count { display: flex; }
        .clear-filters-btn { background: none; border: 1px solid var(--accent-red); color: var(--accent-red); padding: 10px 15px; font-family: var(--font-mono); font-size: 0.9rem; cursor: pointer; border-radius: 4px; transition: var(--transition); display: flex; align-items: center; gap: 8px; }
        .clear-filters-btn:hover { background: var(--accent-red); color: var(--dark-bg); }
        .filter-dropdown {
            position: absolute; top: calc(100% + 10px); left: 0; background: var(--secondary-bg); border: 1px solid var(--border-color);
            border-radius: 8px; padding: 15px; z-index: 100;
            width: 280px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            opacity: 0; transform: translateY(-10px); pointer-events: none; transition: all 0.2s ease-out;
        }
        .filter-dropdown.show { opacity: 1; transform: translateY(0); pointer-events: auto; }
        .filter-options { display: flex; flex-wrap: wrap; gap: 10px; }
        .filter-btn { background: var(--primary-bg); border: 1px solid var(--border-color); color: var(--text-secondary); padding: 5px 15px; font-family: var(--font-mono); font-size: 0.9rem; cursor: pointer; border-radius: 4px; transition: var(--transition); }
        .filter-btn:hover { color: var(--text-primary); border-color: var(--accent-cyan); }
        .filter-btn.active { color: var(--dark-bg); background: var(--accent-cyan); border-color: var(--accent-cyan); font-weight: 700; }
        .range-slider-container { display: flex; flex-direction: column; gap: 10px; }
        .range-slider-container label { font-size: 0.9rem; color: var(--text-primary); }
        .range-slider { -webkit-appearance: none; width: 100%; height: 8px; background: var(--border-color); border-radius: 5px; outline: none; transition: opacity .2s; }
        .range-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: var(--accent-green); border-radius: 50%; cursor: pointer; }
        
        .filter-results-text { margin-left: auto; font-family: var(--font-mono); font-size: 1rem; font-weight: 400; color: var(--text-secondary); }
        
        /* --- PROBLEMS GRID --- */
        .problems-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; }
        .problem-card { display: flex; flex-direction: column; }
        .problem-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .problem-id { font-size: 0.9rem; color: var(--text-secondary); font-family: var(--font-mono); }
        .platform-icon { font-size: 0.9rem; font-weight: 700; font-family: var(--font-mono); }
        .cf { color: var(--accent-red); } .lc { color: var(--accent-yellow); } .cc { color: #a07d4a; } .ac { color: var(--accent-purple); }
        .problem-title { font-size: 1.2rem; margin-bottom: 10px; font-family: var(--font-body); font-weight: 600; flex-grow: 1; }
        .difficulty { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; font-family: var(--font-mono); margin-bottom: 15px; border: 1px solid; align-self: flex-start; }
        .easy { background: rgba(0, 255, 156, 0.1); color: var(--accent-green); border-color: var(--accent-green); }
        .medium { background: rgba(255, 200, 60, 0.1); color: var(--accent-yellow); border-color: var(--accent-yellow); }
        .hard { background: rgba(255, 60, 60, 0.1); color: var(--accent-red); border-color: var(--accent-red); }
        .tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
        .tag { background: rgba(85, 221, 236, 0.1); color: var(--accent-cyan); padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 500; font-family: var(--font-mono); }
        .solve-btn { width: 100%; margin-top: auto; }

        #loader { text-align: center; padding: 20px; display: none; }
        .spinner { border: 4px solid var(--border-color); border-top: 4px solid var(--accent-green); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); z-index: 1040; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; }
        .modal-backdrop.active { opacity: 1; pointer-events: all; }
        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.95); opacity: 0; transition: all 0.3s ease; z-index: 1050; pointer-events: none; width: 90%; max-width: 500px; }
        .modal.active { transform: translate(-50%, -50%) scale(1); opacity: 1; pointer-events: all; }
        
        .mobile-menu-btn { display: none; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-primary); z-index: 1001;}
        .mobile-nav { display: none; flex-direction: column; gap: 10px; background-color: var(--primary-bg); padding: 20px; position: absolute; top: 70px; left: 0; width: 100%; border-bottom: 1px solid var(--border-color); z-index: 999; transform: translateY(-120%); transition: transform 0.3s ease-in-out; visibility: hidden; }
        .mobile-nav.active { display: flex; transform: translateY(0); visibility: visible; }
        .mobile-nav-item { display: flex; align-items: center; gap: 15px; color: var(--text-primary); padding: 10px; border-radius: 4px; font-family: var(--font-mono); text-decoration: none; }
        .mobile-nav-item:hover { background-color: var(--secondary-bg); }

        @media (max-width: 768px) { 
            .mobile-menu-btn { display: block; } .nav-right { display: none; } .binary-clock { display: none; }
            .problems-grid { grid-template-columns: 1fr; }
            .container { width: 95%; }
            .section-title { font-size: clamp(1.4rem, 5vw, 1.6rem); }
            .card { padding: 20px; }
            .timer-progress-container { width: 180px; height: 180px; }
            .timer-display { font-size: clamp(2.8rem, 10vw, 3.5rem); }
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .filter-bar-container { flex-direction: column; align-items: stretch; gap: 15px; }
            .filter-controls { justify-content: center; }
            .filter-results-text { margin-left: 0; text-align: center; order: -1; }
        }

        @media (max-width: 480px) {
            .dashboard-card { padding: 15px; }
            .stats-grid { grid-template-columns: 1fr; }
            .glitch-btn { padding: 8px 16px; font-size: 0.9rem; }
            .filter-dropdown {
                width: calc(100% - 20px);
                left: 50%;
                transform: translateX(-50%) translateY(-10px);
            }
            .filter-dropdown.show { transform: translateX(-50%) translateY(0); }
        }
    </style>
</head>
<body>
    <canvas class="background-canvas" id="background-canvas"></canvas>
    <header>
        <div class="container"><div class="header-content">
            <a href="dashboard.html" class="logo"><i class="fas fa-terminal" style="color: var(--accent-green);"></i>Code<span>Arena</span></a>
            <button class="mobile-menu-btn" id="mobileMenuBtn"><i class="fas fa-bars"></i></button>
            <div class="nav-right" id="navRight"><ul class="nav-links"><li><a href="dashboard.html">Dashboard</a></li><li><a href="practice.html" class="active">Practice</a></li><li><a href="#">Compare</a></li><li><a href="#">Contests</a></li></ul><div class="binary-clock" id="binary-clock"></div><button class="notification-btn"><i class="fas fa-bell"></i><span class="badge">3</span></button><a href="profile.html"><div class="avatar">AC</div></a></div>
        </div></div>
    </header>
    <nav class="mobile-nav" id="mobileNav">
         <a href="dashboard.html" class="mobile-nav-item"><i class="fas fa-chart-line"></i><span>Dashboard</span></a><a href="practice.html" class="mobile-nav-item"><i class="fas fa-pencil-ruler"></i><span>Practice</span></a><a href="#" class="mobile-nav-item"><i class="fas fa-users"></i><span>Compare</span></a><a href="#" class="mobile-nav-item"><i class="fas fa-trophy"></i><span>Contests</span></a><a href="profile.html" class="mobile-nav-item"><div class="avatar" style="position: static; width: 30px; height: 30px;">AC</div><span>Profile</span></a>
    </nav>
    <main class="main-content" id="main-content">
        <div class="container">
            <section class="practice-zone">
                 <h2 class="section-title"><i class="fas fa-tasks"></i>// Practice Dashboard</h2>
                 <div class="practice-dashboard">
                    <div class="dashboard-card timer-panel"><div class="timer-display-wrapper"><h4 id="timer-mode">// Time to Practice</h4><div class="timer-progress-container"><svg class="progress-ring" viewBox="0 0 120 120"><circle stroke-width="6" stroke="var(--border-color)" fill="transparent" r="56" cx="60" cy="60" /><circle id="progress-ring" class="progress-ring__circle" stroke-width="6" stroke-linecap="round" stroke="var(--accent-green)" fill="transparent" r="56" cx="60" cy="60" /></svg><span id="timer-display" class="timer-display">25:00</span></div>
                    <div class="timer-controls">
                        <div id="controls-idle"><button id="start-btn" class="glitch-btn" data-text="Start">Start</button></div>
                        <div id="controls-running" style="display: none;"><button id="break-btn" class="glitch-btn" data-text="Break">Break</button><button id="end-btn" class="glitch-btn" data-text="End" style="--accent-green: var(--accent-red); border-color: var(--accent-red);">End</button></div>
                        <div id="controls-break" style="display: none;"><button id="resume-btn" class="glitch-btn" data-text="Resume">Resume</button><button id="end-break-btn" class="glitch-btn" data-text="End" style="--accent-green: var(--accent-red); border-color: var(--accent-red);">End</button></div>
                        <div id="controls-break-finished" style="display: none;"><button id="start-after-break-btn" class="glitch-btn">Start Practice</button><button id="extend-break-btn" class="glitch-btn" data-text="Extend Break" style="--accent-green: var(--accent-cyan); border-color: var(--accent-cyan);">Extend Break</button></div>
                        <div id="controls-session-finished" style="display: none;"><button id="start-new-session-btn" class="glitch-btn" data-text="New Session">New Session</button><button id="take-break-btn" class="glitch-btn" data-text="Take Break">Take Break</button></div>
                    </div>
                </div>
                        <div class="timer-settings" id="timer-settings">
                            <div class="setting" id="practice-duration"><i class="fas fa-laptop-code"></i><div class="time-selector"><button class="time-selector-btn" data-value="0.3">18s</button><button class="time-selector-btn" data-value="15">15m</button><button class="time-selector-btn active" data-value="25">25m</button><button class="time-selector-btn" data-value="45">45m</button><button class="time-selector-btn" data-value="60">60m</button></div></div>
                            <div class="setting" id="break-duration"><i class="fas fa-coffee"></i><div class="time-selector"><button class="time-selector-btn" data-value="0.3">18s</button><button class="time-selector-btn active" data-value="5">5m</button><button class="time-selector-btn" data-value="10">10m</button><button class="time-selector-btn" data-value="15">15m</button></div></div>
                            <div class="setting">
                                <i class="fas fa-volume-up"></i>
                                <select id="sound-selector" class="sound-selector" title="Select notification sound">
                                    <option value="synth_chime">Synth Chime</option>
                                    <option value="synth_beep">Synth Beep</option>
                                    <option value="synth_descend">Synth Descend</option>
                                    <option value="gentle_marimba">Gentle Marimba</option>
                                    <option value="arcade_alert">Arcade Alert</option>
                                    <option value="positive_chime">Positive Chime</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card"><h3 class="dashboard-card__title"><i class="fas fa-bullseye"></i>// Daily Goal</h3>
                        <div class="goals-container">
                            <div class="goal-item">
                                <div id="goal-time-display" class="goal-display"><div class="goal-progress-bar-container"><div id="goal-progress-bar" style="width: 0%"></div></div><div class="goal-text-container"><span id="goal-text">0 of 60 mins</span><button id="edit-goal-btn" class="edit-goal-btn" title="Edit Time Goal"><i class="fas fa-edit"></i></button></div></div>
                                <div id="goal-input-container" class="goal-input-container"><label for="goal-input" class="filter-label">// Set time goal (minutes):</label><div class="goal-input-wrapper"><input id="goal-input" type="number" value="60" class="goal-input"><button id="set-goal-btn" class="glitch-btn" data-text="Set">Set</button></div></div>
                            </div>
                            <div class="goal-item">
                                <div id="goal-questions-display" class="goal-display"><div class="goal-progress-bar-container"><div id="goal-questions-progress-bar" style="width: 0%"></div></div><div class="goal-text-container"><span id="goal-questions-text">0 of 5 questions</span><button id="edit-questions-goal-btn" class="edit-goal-btn" title="Edit Question Goal"><i class="fas fa-edit"></i></button></div></div>
                                <div id="goal-questions-input-container" class="goal-input-container"><label for="goal-questions-input" class="filter-label">// Set question goal:</label><div class="goal-input-wrapper"><input id="goal-questions-input" type="number" value="5" class="goal-input"><button id="set-questions-goal-btn" class="glitch-btn" data-text="Set">Set</button></div></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card"><h3 class="dashboard-card__title"><i class="fas fa-chart-pie"></i>// Activity Stats</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value dual-stat">
                                    <span id="stats-session-time">0m</span>
                                    <span class="dual-separator">/</span>
                                    <span id="stats-today-time">0m</span>
                                </div>
                                <div class="stat-label dual-label">
                                    <span>Session</span>
                                    <span>Today</span>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="questions-control">
                                    <button class="q-btn" id="q-minus-btn">-</button>
                                    <div class="stat-value dual-stat">
                                        <span id="stats-session-questions">0</span>
                                        <span class="dual-separator">/</span>
                                        <span id="stats-today-questions">0</span>
                                    </div>
                                    <button class="q-btn" id="q-plus-btn">+</button>
                                </div>
                                <div class="stat-label dual-label">
                                    <span>Session</span>
                                    <span>Today</span>
                                </div>
                            </div>
                             <div class="stat-item">
                                <div id="stats-sessions" class="stat-value">0</div>
                                <div class="stat-label">Sessions Today</div>
                            </div>
                            <div class="stat-item">
                                <div id="stats-streak" class="stat-value">0</div>
                                <div class="stat-label">Streak</div>
                            </div>
                        </div>
                    </div>
                 </div>
            </section>
            <section class="problem-list-section">
                <h2 class="section-title">
                    <i class="fas fa-list"></i>// Problem List
                    <span id="filter-results" class="filter-results-text"></span>
                </h2>
                <div class="filter-bar-container card">
                    <div class="search-container">
                        <input type="text" id="search-input" class="search-input" placeholder="Search problems...">
                    </div>
                    <div class="filter-controls">
                        <div class="filter-dropdown-wrapper">
                            <button class="filter-category-btn" data-target="platform-dropdown"><i class="fas fa-laptop-code"></i> Platforms <span class="filter-count" id="platform-filter-count"></span></button>
                            <div id="platform-dropdown" class="filter-dropdown"><div class="filter-options"><button class="filter-btn active" data-value="all">All</button><button class="filter-btn" data-value="cf">Codeforces</button><button class="filter-btn" data-value="lc">LeetCode</button><button class="filter-btn" data-value="cc">CodeChef</button><button class="filter-btn" data-value="ac">AtCoder</button></div></div>
                        </div>
                        <div class="filter-dropdown-wrapper">
                             <button class="filter-category-btn" data-target="difficulty-dropdown"><i class="fas fa-layer-group"></i> Difficulty <span class="filter-count" id="difficulty-filter-count"></span></button>
                             <div id="difficulty-dropdown" class="filter-dropdown"><div id="difficulty-options" class="filter-options"></div></div>
                        </div>
                        <div class="filter-dropdown-wrapper">
                            <button class="filter-category-btn" data-target="topic-dropdown"><i class="fas fa-tag"></i> Topics <span class="filter-count" id="topic-filter-count"></span></button>
                            <div id="topic-dropdown" class="filter-dropdown"><div class="filter-options"><button class="filter-btn active" data-value="all">All</button><button class="filter-btn" data-value="dp">DP</button><button class="filter-btn" data-value="graphs">Graphs</button><button class="filter-btn" data-value="arrays">Arrays</button><button class="filter-btn" data-value="strings">Strings</button><button class="filter-btn" data-value="math">Math</button></div></div>
                        </div>
                        <button id="clear-filters-btn" class="clear-filters-btn" title="Clear all filters"><i class="fas fa-times"></i></button>
                    </div>
                </div>
                <div class="problems-grid" id="problems-grid" style="margin-top: 25px;"></div>
                <div id="loader"><div class="spinner"></div></div>
            </section>
        </div>
    </main>
    <div id="modal-backdrop" class="modal-backdrop"></div><div id="modal" class="modal card"><h2 id="modal-title" class="text-2xl font-bold mb-2">// Time's Up!</h2><p id="modal-message" class="text-slate-400 mb-6">Your practice session has ended. Great job!</p><button id="modal-close-btn" class="glitch-btn w-full" data-text="Okay">Okay</button></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- CORE SETUP & GLOBAL VARS ---
        const mainContent = document.getElementById('main-content');
        
        // --- MATRIX BACKGROUND ---
        const canvas = document.getElementById('background-canvas'); const ctx = canvas.getContext('2d'); let animationFrameId;
        function setupCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        setupCanvas(); const chars = '01$%&/()=*+-#@<>'; const fontSize = 14; const columns = canvas.width / fontSize; const drops = Array.from({ length: columns }).fill(1);
        function drawMatrix() { ctx.fillStyle = 'rgba(10, 10, 10, 0.05)'; ctx.fillRect(0, 0, canvas.width, canvas.height); ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent-green'); ctx.font = `${fontSize}px monospace`; for (let i = 0; i < drops.length; i++) { const text = chars[Math.floor(Math.random() * chars.length)]; ctx.fillText(text, i * fontSize, drops[i] * fontSize); if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0; drops[i]++; } animationFrameId = requestAnimationFrame(drawMatrix); }
        drawMatrix(); window.addEventListener('resize', () => { cancelAnimationFrame(animationFrameId); setupCanvas(); drawMatrix(); });

        // --- BINARY CLOCK & MOBILE NAV ---
        const mobileMenuBtn = document.getElementById('mobileMenuBtn'); const mobileNav = document.getElementById('mobileNav'); mobileMenuBtn.addEventListener('click', () => mobileNav.classList.toggle('active'));
        function updateBinaryClock() { const clock = document.getElementById('binary-clock'); if (!clock) return; const now = new Date(); const h = now.getHours().toString(2).padStart(6, '0'); const m = now.getMinutes().toString(2).padStart(6, '0'); const s = now.getSeconds().toString(2).padStart(6, '0'); clock.textContent = `${h}:${m}:${s}`; }
        setInterval(updateBinaryClock, 1000); updateBinaryClock();

        // --- PRACTICE TIMER & STATE MANAGEMENT ---
        let soundLoopTimeout = null;
        const state = { 
            mode: 'idle', 
            timerInterval: null, 
            totalSeconds: 0, 
            secondsRemaining: 0, 
            practiceSecondsToResume: 0,
            dailyGoal: 60, 
            dailyQuestionGoal: 5, 
            practicedToday: 0, 
            sessionsCompleted: 0, 
            practiceStreak: 0, 
            questionsSolvedToday: 0, 
            sessionTimePracticed: 0,
            sessionQuestionsSolved: 0,
            soundSelection: 'synth_chime',
            activeSessionStart: null,
            lastSavedTime: null
        };
        
        const timerDisplay = document.getElementById('timer-display'); 
        const timerModeDisplay = document.getElementById('timer-mode'); 
        const progressRing = document.getElementById('progress-ring');
        
        const controls = { 
            idle: document.getElementById('controls-idle'), 
            running: document.getElementById('controls-running'), 
            break: document.getElementById('controls-break'),
            break_finished: document.getElementById('controls-break-finished'),
            session_finished: document.getElementById('controls-session-finished')
        };
        
        const timerSettings = document.getElementById('timer-settings');
        const practiceDurationSelector = document.getElementById('practice-duration');
        const soundSelector = document.getElementById('sound-selector');
        
        const goalTimeDisplay = document.getElementById('goal-time-display');
        const goalInputContainer = document.getElementById('goal-input-container');
        const goalInput = document.getElementById('goal-input');
        const goalProgressBar = document.getElementById('goal-progress-bar');
        const goalText = document.getElementById('goal-text');
        const goalQuestionsDisplay = document.getElementById('goal-questions-display');
        const goalQuestionsInputContainer = document.getElementById('goal-questions-input-container');
        const goalQuestionsInput = document.getElementById('goal-questions-input');
        const goalQuestionsProgressBar = document.getElementById('goal-questions-progress-bar');
        const goalQuestionsText = document.getElementById('goal-questions-text');
        
        const stats = { 
            todayTime: document.getElementById('stats-today-time'),
            sessionTime: document.getElementById('stats-session-time'),
            todayQuestions: document.getElementById('stats-today-questions'),
            sessionQuestions: document.getElementById('stats-session-questions'),
            sessions: document.getElementById('stats-sessions'), 
            streak: document.getElementById('stats-streak'), 
        };
        
        const modal = { 
            el: document.getElementById('modal'), 
            backdrop: document.getElementById('modal-backdrop'), 
            title: document.getElementById('modal-title'), 
            message: document.getElementById('modal-message') 
        };
        
        const radius = progressRing.r.baseVal.value; 
        const circumference = radius * 2 * Math.PI; 
        progressRing.style.strokeDasharray = `${circumference} ${circumference}`;
        
        timerSettings.addEventListener('click', (e) => { 
            if (e.target.classList.contains('time-selector-btn')) { 
                const parent = e.target.closest('.time-selector'); 
                if (parent) {
                    parent.querySelectorAll('.time-selector-btn').forEach(btn => btn.classList.remove('active')); 
                    e.target.classList.add('active'); 
                }
                if (state.mode === 'idle') { 
                    const newDuration = getPracticeDuration(); 
                    setTimer(newDuration * 60); 
                } 
            } 
        });
        
        const getPracticeDuration = () => parseFloat(document.querySelector('#practice-duration .active').dataset.value); 
        const getBreakDuration = () => parseFloat(document.querySelector('#break-duration .active').dataset.value);
        
        const saveState = () => {
            state.lastVisit = new Date().toISOString().slice(0, 10);
            if (state.mode === 'running' || state.mode === 'break') {
                state.lastSavedTime = new Date().toISOString();
                if (state.mode === 'running') {
                    state.activeSessionStart = state.activeSessionStart || new Date().toISOString();
                }
            } else {
                state.lastSavedTime = null;
                state.activeSessionStart = null;
            }
            localStorage.setItem('practiceZoneState', JSON.stringify({ ...state, timerInterval: null }));
        };

        const loadState = () => {
            try {
                const saved = JSON.parse(localStorage.getItem('practiceZoneState'));
                if (!saved) return;

                const today = new Date().toISOString().slice(0, 10);
                const lastVisit = saved.lastVisit || today;
                const dayDiff = Math.floor((new Date(today) - new Date(lastVisit)) / (1000 * 60 * 60 * 24));

                Object.keys(state).forEach(key => {
                    if (saved[key] !== undefined) {
                        if (typeof state[key] === 'number') state[key] = parseFloat(saved[key]) || 0;
                        else state[key] = saved[key];
                    }
                });

                if (dayDiff > 0) {
                    if (dayDiff === 1 && saved.practicedToday >= saved.dailyGoal) state.practiceStreak = (saved.practiceStreak || 0) + 1;
                    else if (dayDiff > 1) state.practiceStreak = 0;
                    
                    state.practicedToday = 0; state.sessionsCompleted = 0; state.questionsSolvedToday = 0;
                    state.sessionTimePracticed = 0; state.sessionQuestionsSolved = 0;
                    state.mode = 'idle'; 
                } else if (saved.lastSavedTime && (saved.mode === 'running' || saved.mode === 'break')) {
                    const timeDiffSeconds = Math.floor((new Date() - new Date(saved.lastSavedTime)) / 1000);
                    const originalRemaining = saved.secondsRemaining || 0;

                    if (timeDiffSeconds < originalRemaining) {
                        state.secondsRemaining = Math.max(0, originalRemaining - timeDiffSeconds);
                        if (saved.mode === 'running') {
                            const practicedOfflineMinutes = timeDiffSeconds / 60;
                            state.practicedToday += practicedOfflineMinutes;
                            state.sessionTimePracticed += practicedOfflineMinutes;
                            startTimer();
                            timerModeDisplay.textContent = '// Practice Session';
                        } else {
                            startTimer();
                            timerModeDisplay.textContent = '// On a Break';
                        }
                    } else {
                        if (saved.mode === 'running') {
                            const practicedOfflineMinutes = originalRemaining / 60;
                            state.practicedToday += practicedOfflineMinutes;
                            state.sessionTimePracticed += practicedOfflineMinutes;
                            state.sessionsCompleted++;
                            state.mode = 'session_finished';
                            timerModeDisplay.textContent = '// Session Finished';
                            setTimer(0);
                        } else {
                            state.mode = 'break_finished';
                            timerModeDisplay.textContent = '// Break Finished';
                            showModal("Break's Over!", "Ready to continue?");
                            startSoundLoop();
                        }
                    }
                }
            } catch (error) {
                console.error("Failed to load state from localStorage, resetting...", error);
                localStorage.removeItem('practiceZoneState');
            }
        };

        const updateTimerDisplay = () => { 
            const minutes = Math.floor(state.secondsRemaining / 60); 
            const seconds = state.secondsRemaining % 60; 
            timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`; 
        };
        
        const updateProgressRing = () => { 
            if (state.totalSeconds <= 0) {
                 progressRing.style.strokeDashoffset = circumference;
                 return;
            }
            const progress = (state.totalSeconds - state.secondsRemaining) / state.totalSeconds; 
            progressRing.style.strokeDashoffset = circumference - progress * circumference; 
        };
        
        const updateControls = () => {
            Object.values(controls).forEach(el => el.style.display = 'none');
            if (controls[state.mode]) controls[state.mode].style.display = 'flex';

            const isTimerActive = state.mode === 'running' || state.mode === 'break';
            timerSettings.classList.toggle('disabled', isTimerActive);

            if (state.mode === 'break_finished') {
                practiceDurationSelector.classList.add('disabled');
            } else if (!isTimerActive) {
                practiceDurationSelector.classList.remove('disabled');
            }
        };
        
        const updateGoalUI = () => {
            goalInputContainer.style.display = 'none'; 
            goalTimeDisplay.style.display = 'flex';
            const timeProgress = Math.min((state.practicedToday / state.dailyGoal) * 100, 100);
            goalProgressBar.style.width = `${timeProgress}%`;
            goalText.textContent = `${Math.round(state.practicedToday)} of ${state.dailyGoal} mins`;
            goalInput.value = state.dailyGoal;
            goalQuestionsInputContainer.style.display = 'none'; 
            goalQuestionsDisplay.style.display = 'flex';
            const questionProgress = Math.min((state.questionsSolvedToday / state.dailyQuestionGoal) * 100, 100);
            goalQuestionsProgressBar.style.width = `${questionProgress}%`;
            goalQuestionsText.textContent = `${state.questionsSolvedToday} of ${state.dailyQuestionGoal} questions`;
            goalQuestionsInput.value = state.dailyQuestionGoal;
        };
        
        const updateStatsUI = () => {
            stats.todayTime.textContent = `${Math.round(state.practicedToday)}m`;
            stats.sessionTime.textContent = `${Math.round(state.sessionTimePracticed)}m`;
            stats.todayQuestions.textContent = state.questionsSolvedToday;
            stats.sessionQuestions.textContent = state.sessionQuestionsSolved;
            stats.sessions.textContent = state.sessionsCompleted;
            stats.streak.textContent = `${state.practiceStreak}`;
            updateGoalUI();
        };

        const setTimer = (seconds) => { 
            state.totalSeconds = state.secondsRemaining = seconds; 
            updateTimerDisplay(); 
            updateProgressRing(); 
        };
        
        const startTimer = () => { 
            if (state.timerInterval) clearInterval(state.timerInterval); 
            state.timerInterval = setInterval(() => { 
                state.secondsRemaining--; 
                if(state.mode === 'running') {
                    state.practicedToday += (1/60);
                    state.sessionTimePracticed += (1/60);
                }
                updateTimerDisplay(); 
                updateProgressRing(); 
                updateLiveStats(); 
                if (state.secondsRemaining <= 0) handleTimerEnd(); 
            }, 1000); 
        };
        
        const updateLiveStats = () => {
            stats.todayTime.textContent = `${Math.round(state.practicedToday)}m`;
            stats.sessionTime.textContent = `${Math.round(state.sessionTimePracticed)}m`;
            const progressPercentage = Math.min((state.practicedToday / state.dailyGoal) * 100, 100);
            goalProgressBar.style.width = `${progressPercentage}%`;
            goalText.textContent = `${Math.round(state.practicedToday)} of ${state.dailyGoal} mins`;
        };
        
        const showModal = (title, message) => { 
            modal.title.textContent = `// ${title}`; 
            modal.message.textContent = message; 
            modal.el.classList.add('active'); 
            modal.backdrop.classList.add('active'); 
        };
        
        const startPractice = () => {
            stopSoundLoop();
            state.mode = 'running'; 
            state.activeSessionStart = new Date().toISOString();
            timerModeDisplay.textContent = '// Practice Session';
            
            if (state.practiceSecondsToResume > 0) {
                setTimer(state.practiceSecondsToResume);
                state.practiceSecondsToResume = 0;
            } else {
                state.sessionTimePracticed = 0;
                state.sessionQuestionsSolved = 0;
                setTimer(getPracticeDuration() * 60); 
            }
            
            startTimer(); 
            updateControls(); 
            updateStatsUI();
        };
        
        const startBreak = () => { 
            state.practiceSecondsToResume = state.secondsRemaining;
            initiateBreak();
        };
        
        const initiateBreak = () => {
            clearInterval(state.timerInterval);
            state.mode = 'break'; 
            timerModeDisplay.textContent = '// On a Break';
            setTimer(getBreakDuration() * 60); 
            startTimer(); 
            updateControls(); 
            saveState();
        };
        
        const endSession = () => {
            clearInterval(state.timerInterval);
            stopSoundLoop();
            if (state.mode === 'running') {
                state.sessionsCompleted++;
            }
            state.practicedToday = Math.round(state.practicedToday);
            state.sessionTimePracticed = Math.round(state.sessionTimePracticed);

            state.mode = 'idle';
            state.activeSessionStart = null;
            state.practiceSecondsToResume = 0;
            setTimer(getPracticeDuration() * 60);
            updateControls();
            updateStatsUI();
            saveState();
            timerModeDisplay.textContent = '// Time to Practice';
        };
        
        let audioContextReady = false;
        const ensureAudioContext = async () => {
            if (audioContextReady) return true;
            if (typeof Tone === 'undefined') { console.warn('Tone.js not loaded'); return false; }
            try {
                if (Tone.context.state !== 'running') {
                    await Tone.start();
                    const primer = new Tone.Oscillator().toDestination();
                    primer.volume.value = -Infinity;
                    primer.start().stop("+0.1");
                    setTimeout(() => primer.dispose(), 200);
                }
                audioContextReady = true;
                return true;
            } catch (error) { console.error('Failed to start audio context:', error); audioContextReady = false; return false; }
        };

        const playSound = async (soundName) => {
            const isReady = await ensureAudioContext();
            if (!isReady) { console.warn('Audio context not ready'); return; }
            try {
                const now = Tone.now();
                let synth;
                switch (soundName) {
                    case 'gentle_marimba':
                         synth = new Tone.MetalSynth({ frequency: 200, envelope: { attack: 0.001, decay: 1.4, release: 0.2 }, harmonicity: 5.1, modulationIndex: 32, resonance: 4000, octaves: 1.5 }).toDestination();
                         synth.triggerAttackRelease("C5", "8n", now);
                         break;
                    case 'arcade_alert':
                         synth = new Tone.Synth().toDestination();
                         synth.triggerAttackRelease("C5", "16n", now);
                         synth.triggerAttackRelease("G5", "16n", now + 0.1);
                         synth.triggerAttackRelease("C6", "16n", now + 0.2);
                         break;
                    case 'positive_chime':
                         synth = new Tone.Synth().toDestination();
                         synth.triggerAttackRelease("E5", "8n", now);
                         synth.triggerAttackRelease("A5", "8n", now + 0.15);
                         break;
                    case 'synth_chime':
                         synth = new Tone.Synth().toDestination();
                         synth.triggerAttackRelease("G5", "8n", now);
                         synth.triggerAttackRelease("C6", "8n", now + 0.2);
                         break;
                    case 'synth_descend':
                         synth = new Tone.Synth().toDestination();
                         synth.triggerAttackRelease("C5", "8n", now);
                         synth.triggerAttackRelease("A4", "8n", now + 0.15);
                         synth.triggerAttackRelease("F4", "8n", now + 0.3);
                         break;
                    case 'synth_beep':
                    default:
                         synth = new Tone.Synth().toDestination();
                         synth.triggerAttackRelease("C5", "8n", now);
                         break;
                }
                setTimeout(() => synth.dispose(), 1000);
            } catch (e) { console.error("Error playing sound", e); }
        };

        const stopSoundLoop = () => {
            if (soundLoopTimeout) {
                clearTimeout(soundLoopTimeout);
                soundLoopTimeout = null;
            }
        };

        const soundLoop = () => {
            playSound(state.soundSelection);
            soundLoopTimeout = setTimeout(soundLoop, 4000);
        };
        
        const startSoundLoop = () => {
            stopSoundLoop();
            soundLoop();
        };

        const startLimitedSoundLoop = (count = 3) => {
            stopSoundLoop();
            if (count <= 0) return;
            playSound(state.soundSelection);
            soundLoopTimeout = setTimeout(() => {
                startLimitedSoundLoop(count - 1);
            }, 4000);
        };
        
        const handleTimerEnd = () => {
            clearInterval(state.timerInterval);
            state.practicedToday = Math.round(state.practicedToday);
            state.sessionTimePracticed = Math.round(state.sessionTimePracticed);
            
            if (state.mode === 'running') {
                state.sessionsCompleted++;
                state.practiceSecondsToResume = 0;
                state.mode = 'session_finished';
                timerModeDisplay.textContent = '// Session Finished';
                setTimer(0);
                showModal("Practice Complete!", "Great job! What's next?");
                startLimitedSoundLoop(3);
            } else if (state.mode === 'break') {
                state.mode = 'break_finished';
                timerModeDisplay.textContent = '// Break Finished';
                
                const continueBtn = document.getElementById('start-after-break-btn');
                if (state.practiceSecondsToResume > 0) {
                    continueBtn.textContent = 'Continue Session';
                    continueBtn.dataset.text = 'Continue Session';
                } else {
                    continueBtn.textContent = 'Start Practice';
                    continueBtn.dataset.text = 'Start Practice';
                }
                showModal("Break's Over!", "Ready to continue?");
                startSoundLoop();
            }
            updateControls();
            saveState();
            updateStatsUI();
        };

        // --- EVENT LISTENERS ---
        document.body.addEventListener('click', () => ensureAudioContext(), { once: true });
        soundSelector.addEventListener('change', () => { state.soundSelection = soundSelector.value; playSound(state.soundSelection); saveState(); });
        document.getElementById('start-btn').addEventListener('click', startPractice);
        document.getElementById('break-btn').addEventListener('click', startBreak);
        document.getElementById('end-btn').addEventListener('click', endSession);
        document.getElementById('resume-btn').addEventListener('click', startPractice);
        document.getElementById('end-break-btn').addEventListener('click', endSession);
        document.getElementById('start-after-break-btn').addEventListener('click', startPractice);
        
        const closeModalAndStopSound = () => {
            stopSoundLoop();
            modal.el.classList.remove('active');
            modal.backdrop.classList.remove('active');
        };

        document.getElementById('modal-close-btn').addEventListener('click', closeModalAndStopSound);

        document.getElementById('start-new-session-btn').addEventListener('click', () => {
            closeModalAndStopSound();
            startPractice();
        });

        document.getElementById('take-break-btn').addEventListener('click', () => {
            closeModalAndStopSound();
            initiateBreak();
        });
        
        document.getElementById('extend-break-btn').addEventListener('click', () => {
            closeModalAndStopSound();
            initiateBreak();
        });
        
        document.getElementById('edit-goal-btn').addEventListener('click', () => { goalInputContainer.style.display = 'block'; goalTimeDisplay.style.display = 'none'; });
        document.getElementById('set-goal-btn').addEventListener('click', () => { const val = parseInt(goalInput.value); if (val > 0) { state.dailyGoal = val; saveState(); updateGoalUI(); } });
        document.getElementById('edit-questions-goal-btn').addEventListener('click', () => { goalQuestionsInputContainer.style.display = 'block'; goalQuestionsDisplay.style.display = 'none'; });
        document.getElementById('set-questions-goal-btn').addEventListener('click', () => { const val = parseInt(goalQuestionsInput.value); if (val > 0) { state.dailyQuestionGoal = val; saveState(); updateGoalUI(); } });
        
        document.getElementById('q-plus-btn').addEventListener('click', () => {
            state.sessionQuestionsSolved++;
            state.questionsSolvedToday++;
            updateStatsUI();
            saveState();
        });
        document.getElementById('q-minus-btn').addEventListener('click', () => {
            if (state.sessionQuestionsSolved > 0) {
                state.sessionQuestionsSolved--;
                state.questionsSolvedToday = Math.max(0, state.questionsSolvedToday - 1);
                updateStatsUI();
                saveState();
            }
        });

        window.addEventListener('beforeunload', saveState);
        
        // --- INITIAL LOAD & FILTERING LOGIC ---
        loadState(); 
        if (state.mode === 'idle') setTimer(getPracticeDuration() * 60);
        updateTimerDisplay();
        updateProgressRing();
        updateStatsUI(); 
        updateControls();
        
        // --- ADVANCED FILTERING & INFINITE SCROLL ---
        const problemsGrid = document.getElementById('problems-grid'); const loader = document.getElementById('loader'); const searchInput = document.getElementById('search-input'); const filterResultsText = document.getElementById('filter-results');
        const difficultyDropdown = document.getElementById('difficulty-dropdown');
        const difficultyOptionsContainer = document.getElementById('difficulty-options');
        let masterProblemList = []; let filteredProblems = []; let isLoading = false; let currentProblemIndex = 0; const problemsPerLoad = 12;
        let filterState = { search: '', platforms: [], topics: [], difficulty: { type: 'normalized', values: [] } };
        const problemTemplates = [
            { id: 'CF-1234A', platform: 'cf', title: 'Array Transformation', ratings: { cf: 1200 }, tags: ['arrays', 'greedy'] }, { id: 'LC-5678B', platform: 'lc', title: 'Binary Tree Max Path Sum', ratings: { lc: 'Hard' }, tags: ['trees', 'dfs', 'dp'] },
            { id: 'CC-9012C', platform: 'cc', title: 'Chef and Strings', ratings: { cc: 'Medium' }, tags: ['strings', 'hashing'] }, { id: 'AC-3456D', platform: 'ac', title: 'Grid and Tokens', ratings: { ac: 800 }, tags: ['graphs', 'bfs'] },
            { id: 'CF-1521C', platform: 'cf', title: 'Yet Another Query Problem', ratings: { cf: 1600 }, tags: ['dp', 'data-structures'] }, { id: 'LC-1', platform: 'lc', title: 'Two Sum', ratings: { lc: 'Easy' }, tags: ['arrays', 'hashing'] },
            { id: 'AC-DP-A', platform: 'ac', title: 'Frog 1', ratings: { ac: 400 }, tags: ['dp'] }, { id: 'CC-PALIN', platform: 'cc', title: 'Palindrome Equation', ratings: { cc: 'Hard' }, tags: ['math', 'strings'] },
            { id: 'LC-200', platform: 'lc', title: 'Number of Islands', ratings: { lc: 'Medium' }, tags: ['graphs', 'dfs', 'bfs'] }, { id: 'CF-455A', platform: 'cf', title: 'Boredom', ratings: { cf: 1900 }, tags: ['dp'] },
            { id: 'AC-ABC170-C', platform: 'ac', title: 'Forbidden List', ratings: { ac: 200 }, tags: ['brute-force', 'math'] }, { id: 'LC-42', platform: 'lc', title: 'Trapping Rain Water', ratings: { lc: 'Hard' }, tags: ['arrays', 'two-pointers', 'dp'] }
        ];

        function createProblemCard(problem) {
            const card = document.createElement('div');
            card.className = `problem-card card`;
            const sanitize = (str) => { if (str === undefined || str === null) return ''; const div = document.createElement('div'); div.textContent = String(str); return div.innerHTML; };
            const platformColors = { cf: 'var(--accent-red)', lc: 'var(--accent-yellow)', cc: '#a07d4a', ac: 'var(--accent-purple)'};
            const difficultyValue = problem.ratings.lc || problem.ratings.cc || (problem.ratings.cf ? `CF ${problem.ratings.cf}` : `AC ${problem.ratings.ac}`);
            let difficultyClass = typeof difficultyValue === 'string' ? difficultyValue.split(' ')[0].toLowerCase() : 'medium';
            const safeId = sanitize(problem.id); const safeTitle = sanitize(problem.title); const safePlatform = sanitize(problem.platform); const safeDifficulty = sanitize(difficultyValue); const safeTags = problem.tags.map(tag => `<span class="tag">${sanitize(tag)}</span>`).join('');
            card.innerHTML = `<div class="problem-header"><div class="problem-id">${safeId}</div><div class="platform-icon" style="color:${platformColors[problem.platform]}">${safePlatform.toUpperCase()}</div></div><h3 class="problem-title">${safeTitle}</h3><span class="difficulty ${difficultyClass}">${safeDifficulty}</span><div class="tags">${safeTags}</div><button class="glitch-btn solve-btn" data-text="Solve">Solve</button>`;
            return card;
        }
        
        function updateDifficultyFilterUI() {
            const { platforms } = filterState; let html = ''; const currentValues = new Set(filterState.difficulty.values);
            if (platforms.length === 1 && (platforms[0] === 'cf' || platforms[0] === 'ac')) {
                const type = platforms[0]; const max = filterState.difficulty.max || 3500;
                filterState.difficulty = { type: `range-${type}`, max: max };
                html = `<div class="range-slider-container"><label for="${type}-range">Rating: <span id="${type}-range-value">800 - ${max}</span></label><input type="range" min="800" max="3500" value="${max}" class="range-slider" id="${type}-range"></div>`;
            } else if (platforms.length > 0 && platforms.every(p => ['lc', 'cc'].includes(p))) {
                filterState.difficulty = { type: 'specific-lc-cc', values: Array.from(currentValues) };
                html = ['Easy', 'Medium', 'Hard'].map(d => `<button class="filter-btn ${currentValues.has(d) ? 'active' : ''}" data-value="${d}">${d}</button>`).join('');
            } else {
                filterState.difficulty = { type: 'normalized', values: Array.from(currentValues) };
                html = ['Beginner', 'Intermediate', 'Advanced', 'Expert'].map(d => `<button class="filter-btn ${currentValues.has(d) ? 'active' : ''}" data-value="${d}">${d}</button>`).join('');
            }
            difficultyOptionsContainer.innerHTML = html; updateFilterCount(difficultyDropdown.parentElement);
        }
        
        function getNormalizedDifficulty(problem) {
            const { ratings, platform } = problem;
            if (platform === 'lc' || platform === 'cc') {
                if (ratings[platform] === 'Easy') return 'Beginner';
                if (ratings[platform] === 'Medium') return 'Intermediate';
                if (ratings[platform] === 'Hard') return 'Advanced';
            } else if (platform === 'cf' || platform === 'ac') {
                const rating = ratings[platform];
                if (rating < 1200) return 'Beginner';
                if (rating < 1600) return 'Intermediate';
                if (rating < 2100) return 'Advanced';
                return 'Expert';
            }
            return 'Intermediate';
        }

        function applyFiltersAndRender() {
            const scrollPosition = mainContent.scrollTop;
            filteredProblems = masterProblemList.filter(p => {
                const { difficulty, search, platforms, topics } = filterState;
                if (platforms.length > 0 && !platforms.includes(p.platform)) return false;
                if (topics.length > 0 && !topics.some(topic => p.tags.includes(topic))) return false;
                if (search && !p.title.toLowerCase().includes(search) && !p.id.toLowerCase().includes(search)) return false;
                if (difficulty.type === 'normalized' && difficulty.values.length > 0) if (!difficulty.values.includes(getNormalizedDifficulty(p))) return false;
                else if (difficulty.type === 'specific-lc-cc' && difficulty.values.length > 0) if (!difficulty.values.includes(p.ratings[p.platform])) return false;
                else if (difficulty.type.startsWith('range-') && p.platform === difficulty.type.split('-')[1]) if (p.ratings[p.platform] > difficulty.max) return false;
                return true;
            });
            filterResultsText.textContent = `// ${filteredProblems.length} match${filteredProblems.length !== 1 ? 'es' : ''} found`;
            problemsGrid.innerHTML = ''; currentProblemIndex = 0;
            if (filteredProblems.length > 0) renderMoreProblems();
            else { problemsGrid.innerHTML = '<p style="color: var(--text-secondary); grid-column: 1 / -1; text-align: center;">// No problems found.</p>'; loader.style.display = 'none'; }
            mainContent.scrollTop = scrollPosition;
        }
        
        function renderMoreProblems() {
            if (isLoading || currentProblemIndex >= filteredProblems.length) return;
            isLoading = true; loader.style.display = 'block';
            setTimeout(() => {
                const fragment = document.createDocumentFragment();
                const end = Math.min(currentProblemIndex + problemsPerLoad, filteredProblems.length);
                for (let i = currentProblemIndex; i < end; i++) fragment.appendChild(createProblemCard(filteredProblems[i]));
                problemsGrid.appendChild(fragment); currentProblemIndex = end;
                if (currentProblemIndex >= filteredProblems.length) loader.style.display = 'none';
                isLoading = false;
            }, 300);
        }
        
        function updateFilterCount(wrapper) {
            const btnCount = wrapper.querySelectorAll('.filter-options .filter-btn.active:not([data-value="all"])').length;
            const rangeSlider = wrapper.querySelector('.range-slider');
            const count = rangeSlider ? (rangeSlider.value !== rangeSlider.max ? 1 : 0) : btnCount;
            const countEl = wrapper.querySelector('.filter-count'); const catBtn = wrapper.querySelector('.filter-category-btn');
            if (count > 0) { countEl.textContent = count; countEl.style.display = 'flex'; catBtn.classList.add('active'); } 
            else { countEl.style.display = 'none'; catBtn.classList.remove('active'); }
        }

        document.querySelectorAll('.filter-dropdown-wrapper').forEach(wrapper => {
            const btn = wrapper.querySelector('.filter-category-btn'); const dropdown = document.getElementById(btn.dataset.target);
            btn.addEventListener('click', (e) => { e.stopPropagation(); const isShowing = dropdown.classList.contains('show'); document.querySelectorAll('.filter-dropdown').forEach(d => d.classList.remove('show')); if (!isShowing) dropdown.classList.add('show'); });
        });

        document.querySelectorAll('.filter-dropdown').forEach(dropdown => {
            dropdown.addEventListener('click', (e) => {
                const filterBtn = e.target.closest('.filter-btn'); if (!filterBtn) return; e.stopPropagation();
                const value = filterBtn.dataset.value; const options = dropdown.querySelector('.filter-options');
                if(value === 'all') { options.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active')); filterBtn.classList.add('active'); } 
                else { options.querySelector('[data-value="all"]')?.classList.remove('active'); filterBtn.classList.toggle('active'); if (options.querySelectorAll('.filter-btn.active:not([data-value="all"])').length === 0) options.querySelector('[data-value="all"]')?.classList.add('active'); }
                filterState.platforms = Array.from(document.querySelectorAll('#platform-dropdown .filter-btn.active:not([data-value="all"])')).map(b => b.dataset.value);
                filterState.topics = Array.from(document.querySelectorAll('#topic-dropdown .filter-btn.active:not([data-value="all"])')).map(b => b.dataset.value);
                if(dropdown.id.includes('platform')) updateDifficultyFilterUI();
                filterState.difficulty.values = Array.from(difficultyOptionsContainer.querySelectorAll('.filter-btn.active')).map(b => b.dataset.value);
                document.querySelectorAll('.filter-dropdown-wrapper').forEach(updateFilterCount); applyFiltersAndRender();
            });
            dropdown.addEventListener('input', (e) => {
                if (e.target.classList.contains('range-slider')) {
                    const value = e.target.value; const type = e.target.id.split('-')[0];
                    filterState.difficulty.max = parseInt(value);
                    document.getElementById(`${type}-range-value`).textContent = `800 - ${value}`;
                    updateFilterCount(dropdown.parentElement); applyFiltersAndRender();
                }
            });
        });

        document.addEventListener('click', () => { document.querySelectorAll('.filter-dropdown').forEach(d => d.classList.remove('show')); });
        
        let searchTimeout;
        searchInput.addEventListener('input', (e) => { clearTimeout(searchTimeout); searchTimeout = setTimeout(() => { filterState.search = e.target.value.toLowerCase(); applyFiltersAndRender(); }, 300); });
        
        document.getElementById('clear-filters-btn').addEventListener('click', () => {
            filterState = { search: '', platforms: [], topics: [], difficulty: { type: 'normalized', values: [] } };
            searchInput.value = '';
            document.querySelectorAll('.filter-options').forEach(opt => { opt.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active')); opt.querySelector('[data-value="all"]')?.classList.add('active'); });
            updateDifficultyFilterUI(); applyFiltersAndRender(); document.querySelectorAll('.filter-dropdown-wrapper').forEach(updateFilterCount);
        });
        
        mainContent.addEventListener('scroll', () => { if (mainContent.scrollTop + mainContent.clientHeight >= mainContent.scrollHeight - 200) renderMoreProblems(); });
        
        masterProblemList = Array(50).fill(problemTemplates).flat().map((p, i) => { const newP = {...p, id: `${p.platform.toUpperCase()}-${Math.floor(1000 + Math.random() * 9000)}-${i}`}; if (newP.platform === 'cf' || newP.platform === 'ac') newP.ratings[newP.platform] = Math.floor((Math.random() * 2700) + 800); return newP; });
        updateDifficultyFilterUI(); applyFiltersAndRender();
    });
    </script>
</body>
</html>